FROM ollama/ollama

EXPOSE 11434



# 1. ë¹Œë“œ ì‹œ ë³„ë„ ê²½ë¡œì— ëª¨ë¸ ë‹¤ìš´ë¡œë“œ
ENV OLLAMA_MODELS=/opt/models
RUN ollama serve & \
    sleep 5 && \
    ollama pull deepseek-r1:8b && \
    kill $(pidof ollama) && \
    sleep 2

# 2. ì§„ìž…ì  ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
RUN echo '#!/bin/sh\n\
  if [ ! -d "/root/.ollama/models" ]; then\n\
    echo "ðŸ”¨ Initializing volume with pre-downloaded model..."\n\
    mkdir -p /root/.ollama\n\
    cp -r /opt/models/* /root/.ollama/\n\
  fi\n\
  exec ollama serve' > /entrypoint.sh && \
    chmod +x /entrypoint.sh

ENTRYPOINT ["/entrypoint.sh"]
